form.addEventListener("submit", async (e) => {
  e.preventDefault();
  loading.classList.remove("hidden");
  resultSection.classList.add("hidden");

  try {
    const response = await fetch("/.netlify/functions/generate-video", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        script: scriptInput.value,
        imageUrl: imageUrlInput.value,
        voiceId: voiceSelect.value
      })
    });

    const result = await response.json();

    if (result.video_url) {
      aiVideo.src = result.video_url;
      downloadBtn.href = result.video_url;
      loading.classList.add("hidden");
      resultSection.classList.remove("hidden");
    } else {
      alert("Video generation failed. Please check your inputs.");
      loading.classList.add("hidden");
    }
  } catch (error) {
    console.error("Error generating video:", error);
    alert("Something went wrong. Please try again later.");
    loading.classList.add("hidden");
  }
});
